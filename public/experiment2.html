<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Find-S: Secure Assessment</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  :root {
    /* UI Theme */
    --bg-app: #f8fafc;
    --panel-bg: #ffffff;
    --border: #e2e8f0;
    
    /* Brand Colors */
    --primary: #7c3aed; /* Violet */
    --primary-dark: #5b21b6;
    --secondary: #64748b;
    
    /* Terminal Colors */
    --term-bg: #0f172a;
    --term-text: #e2e8f0;
    --term-green: #22c55e;
    --term-blue: #60a5fa;
    --term-red: #f87171;
    --term-yellow: #facc15;
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-app);
    background-image: 
        radial-gradient(at 0% 0%, rgba(124, 58, 237, 0.05) 0px, transparent 50%),
        radial-gradient(at 100% 100%, rgba(59, 130, 246, 0.05) 0px, transparent 50%);
    color: #1e293b;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* --- HEADER --- */
  .app-container {
    max-width: 1400px; margin: 0 auto; padding: 20px;
    display: flex; flex-direction: column; gap: 15px;
    height: 100%; width: 100%;
    filter: blur(0px); /* Used for blocking transition */
    transition: filter 0.3s;
  }

  .header-bar {
    display: flex; justify-content: space-between; align-items: center;
    background: var(--panel-bg); padding: 15px 24px;
    border-radius: 16px; border: 1px solid var(--border);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    flex-shrink: 0;
  }
  .app-title { font-weight: 800; font-size: 1.4rem; background: linear-gradient(to right, var(--primary), #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  
  .header-right { display: flex; align-items: center; gap: 12px; }

  .status-badge { background: #dcfce7; color: #166534; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; border: 1px solid #86efac; }
  
  .timer-badge { 
    font-family: 'JetBrains Mono', monospace; 
    background: #f1f5f9; color: #334155; 
    padding: 8px 16px; border-radius: 8px; 
    font-size: 1rem; font-weight: 700; 
    border: 1px solid var(--border);
    display: flex; align-items: center; gap: 8px;
  }

  /* --- GRID LAYOUT --- */
  .main-grid {
    display: grid; grid-template-columns: 320px 1fr;
    grid-template-rows: 1fr 200px; gap: 20px; flex: 1; min-height: 0;
  }

  /* --- CONTROLS PANEL --- */
  .controls-panel {
    grid-column: 1; grid-row: 1 / span 2;
    background: var(--panel-bg); border-radius: 20px; border: 1px solid var(--border);
    padding: 24px; display: flex; flex-direction: column; gap: 20px;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.03);
    overflow-y: auto;
  }
  
  .panel-label { font-size: 0.75rem; font-weight: 800; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; border-bottom: 1px solid var(--border); padding-bottom: 8px; }
  
  .input-group { margin-bottom: 12px; }
  .input-group label { display: block; font-size: 0.85rem; font-weight: 700; color: #475569; margin-bottom: 6px; }
  .input-group select {
    width: 100%; padding: 10px; border-radius: 10px; border: 2px solid var(--border);
    font-size: 0.9rem; font-family: 'Inter'; cursor: pointer; outline: none; background: #f8fafc;
    transition: all 0.2s;
  }
  .input-group select:focus { border-color: var(--primary); background: white; box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1); }

  .btn-success { 
    width: 100%; padding: 14px; border: none; border-radius: 12px;
    background: #16a34a; color: white; font-weight: 700; font-size: 1rem;
    box-shadow: 0 4px 10px rgba(22, 163, 74, 0.3); cursor: pointer; transition: all 0.2s;
    margin-top: auto;
  }
  .btn-success:hover { background: #15803d; transform: translateY(-2px); }
  .btn-success:active { transform: scale(0.98); }

  /* --- VISUALIZATION AREA --- */
  .viz-panel {
    grid-column: 2; grid-row: 1;
    background: white; border-radius: 20px; border: 1px solid var(--border);
    display: flex; flex-direction: column; overflow-y: auto;
    position: relative;
  }

  .section-title {
    font-size: 0.9rem; font-weight: 700; color: var(--secondary);
    padding: 20px 24px 10px 24px;
    display: flex; align-items: center; gap: 8px;
  }
  
  /* --- DATA TABLE --- */
  .table-wrapper {
    padding: 0 24px 20px 24px;
    border-bottom: 1px solid var(--border);
  }
  
  .data-table {
    width: 100%; border-collapse: collapse; font-size: 0.9rem;
    border-radius: 8px; overflow: hidden; border: 1px solid var(--border);
  }
  .data-table th {
    background: #f1f5f9; text-align: left; padding: 12px;
    font-size: 0.75rem; text-transform: uppercase; color: #64748b; font-weight: 700;
    border-bottom: 1px solid var(--border);
  }
  .data-table td {
    padding: 12px; border-bottom: 1px solid var(--border); color: #334155;
  }
  .data-table tr:last-child td { border-bottom: none; }
  .data-table tr:hover { background: #f8fafc; }
  
  .badge {
    padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase;
  }
  .badge-yes { background: #dcfce7; color: #15803d; border: 1px solid #86efac; }
  .badge-no { background: #fee2e2; color: #b91c1c; border: 1px solid #fca5a5; }

  /* Prediction Result Area */
  .result-area {
    flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
    background: #f8fafc; padding: 30px; min-height: 250px;
  }
  
  .pred-card {
    background: white; padding: 30px; border-radius: 24px; text-align: center;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.08);
    border: 1px solid var(--border); opacity: 0; transform: translateY(20px); transition: all 0.5s ease;
    max-width: 450px; width: 100%;
  }
  .pred-card.show { opacity: 1; transform: translateY(0); }
  
  .pred-status { font-size: 0.85rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; color: #64748b; }
  .pred-value { font-size: 3.5rem; font-weight: 900; line-height: 1; margin-bottom: 15px; }
  .pred-details { font-size: 1rem; color: #334155; line-height: 1.5; }

  /* --- TERMINAL --- */
  .terminal-panel {
    grid-column: 2; grid-row: 2;
    background: var(--term-bg); border-radius: 16px; border: 1px solid #334155;
    display: flex; flex-direction: column; overflow: hidden;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
  }
  .term-header {
    background: #1e293b; padding: 10px 20px; border-bottom: 1px solid #334155;
    display: flex; justify-content: space-between; align-items: center;
  }
  .term-title { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; font-weight: 700; color: #94a3b8; display: flex; align-items: center; gap: 8px; }
  .pulse { width: 8px; height: 8px; background: var(--term-green); border-radius: 50%; box-shadow: 0 0 8px var(--term-green); animation: pulse 2s infinite; }
  @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

  .term-body {
    flex: 1; padding: 16px; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;
    color: var(--term-text); overflow-y: auto; line-height: 1.6;
  }
  .log-line { display: flex; gap: 12px; margin-bottom: 4px; }
  .ts { color: #475569; min-width: 70px; }
  .msg-sys { color: var(--term-yellow); font-style: italic; }
  .msg-act { color: var(--term-blue); font-weight: 700; }
  .msg-suc { color: var(--term-green); }
  .msg-err { color: var(--term-red); font-weight: 700; }
  
  .cursor { display: inline-block; width: 8px; height: 16px; background: var(--term-green); vertical-align: sub; animation: blink 1s infinite; }
  @keyframes blink { 50% { opacity: 0; } }

  /* --- OVERLAYS (WARNING & BLOCK) --- */
  .overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 9999; display: flex; justify-content: center; align-items: center;
    backdrop-filter: blur(8px);
    opacity: 0; pointer-events: none; transition: opacity 0.3s;
  }
  .overlay.active { opacity: 1; pointer-events: all; }

  /* Warning Modal */
  .warning-modal {
    background: #fff; padding: 30px; border-radius: 20px; text-align: center;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    border: 2px solid #f59e0b; max-width: 400px;
    transform: scale(0.9); transition: transform 0.3s;
  }
  .overlay.active .warning-modal { transform: scale(1); }
  .warn-icon { font-size: 3rem; color: #f59e0b; margin-bottom: 15px; }
  .warn-title { font-size: 1.5rem; font-weight: 800; color: #1e293b; margin-bottom: 10px; }
  .warn-desc { color: #64748b; margin-bottom: 20px; line-height: 1.5; }
  .btn-warn { background: #f59e0b; color: #fff; border:none; padding:10px 20px; border-radius:8px; font-weight:700; cursor:pointer; }

  /* Blocked Screen */
  .blocked-screen {
    background: #0f172a; color: #fff; flex-direction: column;
  }
  .blocked-icon { font-size: 5rem; color: #ef4444; margin-bottom: 20px; }
  .blocked-title { font-size: 2.5rem; font-weight: 900; color: #ef4444; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px; }

  @media (max-width: 1024px) {
    .main-grid { grid-template-columns: 1fr; grid-template-rows: auto auto auto 200px; }
    .controls-panel { grid-column: 1; grid-row: 1; max-height: 300px; }
    .viz-panel { grid-column: 1; grid-row: 2; height: 500px; }
    .terminal-panel { grid-column: 1; grid-row: 3; }
  }
</style>
</head>
<body>

<div class="overlay" id="warningOverlay">
    <div class="warning-modal">
        <div class="warn-icon"><i class="fa-solid fa-triangle-exclamation"></i></div>
        <div class="warn-title">Malpractice Warning</div>
        <div class="warn-desc" id="warningText">
            You attempted to leave the tab or capture the screen. This action has been logged.
        </div>
        <button class="btn-warn" onclick="dismissWarning()">I Understand</button>
    </div>
</div>

<div class="overlay blocked-screen" id="blockOverlay">
    <div class="blocked-icon"><i class="fa-solid fa-ban"></i></div>
    <div class="blocked-title">TERMINATED</div>
    <div style="font-family: 'JetBrains Mono'; color: #94a3b8; max-width: 500px; text-align: center;">
        Your session has been locked due to repeated security violations (Tab Switching / Screenshots). <br><br>
        Please contact the administrator.
    </div>
</div>

<div class="app-container" id="appContent">
  
  <header class="header-bar">
    <div class="app-title">Find-S: Secure Assessment</div>
    <div class="header-right">
        <div class="timer-badge">
            <i class="fa-regular fa-clock" style="font-style: normal;">‚è±</i>
            <span id="timerDisplay">00:00</span>
        </div>
        <div class="status-badge">Randomized | Monitored</div>
    </div>
  </header>

  <div class="main-grid">
    
    <aside class="controls-panel">
      <div class="panel-label">Guess the Hypothesis</div>
      
      <div id="inputContainer">
        </div>

      <button class="btn-success" id="btnPredict">
        Check Your Hypothesis
      </button>
    </aside>

    <main class="viz-panel">
      
      <div class="section-title">
        <i class="fa-solid fa-table"></i> Training Dataset (EnjoySport - Randomized)
      </div>
      <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Example</th>
                    <th>Sky</th>
                    <th>Temp</th>
                    <th>Humid</th>
                    <th>Wind</th>
                    <th>Water</th>
                    <th>Forecast</th>
                    <th>Target</th>
                </tr>
            </thead>
            <tbody id="dataTableBody">
                </tbody>
        </table>
      </div>

      <div class="result-area">
        <div id="predCard" class="pred-card">
          <div class="pred-status">Validation Result</div>
          <div class="pred-value" id="predVal">--</div>
          <div class="pred-details" id="predReason">Can you determine the hypothesis from the table above? Enter your guess on the left.</div>
        </div>
      </div>
    </main>

    <footer class="terminal-panel">
      <div class="term-header">
        <div class="term-title"><div class="pulse"></div> SYSTEM_LOGS // PREDICTOR</div>
        <div style="font-size:0.7rem; color:#64748b; font-weight:700;">LIVE</div>
      </div>
      <div class="term-body" id="termBody">
        <div class="log-line"><span class="ts">SYS</span><span class="msg-sys">Initializing Secure Environment...</span></div>
        <div class="log-line"><span class="ts">SEC</span><span class="msg-sys">Malpractice Monitor Active (Tab/Screen)</span></div>
        <div id="termCursor" class="cursor"></div>
      </div>
    </footer>

  </div>
</div>

<script>
/* =========================================================
   1) SECURITY / MALPRACTICE LOGIC
========================================================= */
let tabSwitchCount = 0;
let screenshotCount = 0;
let isBlocked = false;

// Trigger Violation Handler
function handleViolation(type) {
    if(isBlocked) return;

    let count = (type === 'Tab Switch') ? ++tabSwitchCount : ++screenshotCount;
    
    // Log to terminal
    logTerm(`VIOLATION DETECTED: ${type} (Attempt ${count}/3)`, "error");

    if (count < 3) {
        // Warning 1 & 2
        showWarning(type, count);
    } else {
        // Warning 3 -> Block
        triggerBlock();
    }
}

// Show Warning Modal
function showWarning(type, count) {
    const overlay = document.getElementById('warningOverlay');
    const text = document.getElementById('warningText');
    const app = document.getElementById('appContent');
    
    text.innerHTML = `<strong>${type} Detected!</strong><br>This is warning <strong>${count} of 2</strong>.<br>Further violations will result in immediate termination.`;
    
    overlay.classList.add('active');
    app.style.filter = "blur(5px)";
}

// Dismiss Warning
function dismissWarning() {
    document.getElementById('warningOverlay').classList.remove('active');
    document.getElementById('appContent').style.filter = "none";
}

// Permanent Block
function triggerBlock() {
    isBlocked = true;
    stopTimer();
    document.getElementById('warningOverlay').classList.remove('active'); // Remove warning if present
    document.getElementById('blockOverlay').classList.add('active'); // Add block
    document.getElementById('appContent').style.filter = "blur(10px)";
    logTerm("SESSION TERMINATED: Maximum violations reached.", "error");
}

// Event 1: Tab Switching (Visibility Change)
document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
        handleViolation('Tab Switch');
    }
});

// Event 2: Screenshot Detection (Keyboard Heuristics)
// Note: Standard Web APIs cannot detect OS-level screenshots perfectly for privacy reasons.
// We detect standard keys: PrintScreen, Win+Shift+S, Cmd+Shift+3/4
window.addEventListener('keyup', (e) => {
    if (e.key === 'PrintScreen') {
        handleViolation('Screenshot Attempt');
    }
});

// Keydown for combinations (Meta/Control + Shift + S/3/4)
window.addEventListener('keydown', (e) => {
    // Windows Snipping Tool (Win+Shift+S) or Mac (Cmd+Shift+3/4)
    if ((e.metaKey || e.ctrlKey) && e.shiftKey && (e.key === 's' || e.key === 'S' || e.key === '3' || e.key === '4')) {
        e.preventDefault(); // Try to prevent default behavior
        handleViolation('Screenshot Attempt');
    }
});


/* =========================================================
   2) CONFIGURATION & DATA GENERATION
========================================================= */
const attributes = ["Sky", "AirTemp", "Humidity", "Wind", "Water", "Forecast"];

// Raw Domains for Generation
const rawDomains = [
    ['Sunny', 'Rainy', 'Cloudy'],       // Sky
    ['Warm', 'Cold'],                   // AirTemp
    ['Normal', 'High'],                 // Humidity
    ['Strong', 'Weak'],                 // Wind
    ['Warm', 'Cool'],                   // Water
    ['Same', 'Change']                  // Forecast
];

// Dropdown Options (Includes '?')
const dropdownOptions = rawDomains.map(d => ['?', ...d]);

let trainingData = [];
let finalHypothesis = [];
let timerInterval;
let seconds = 0;

/* --- LOGIC: GENERATE RANDOM SCENARIO --- */
function generateScenario() {
    const secretConcept = rawDomains.map(domain => {
        if (Math.random() > 0.4) {
            return domain[Math.floor(Math.random() * domain.length)];
        }
        return '?';
    });

    let specificCount = secretConcept.filter(x => x !== '?').length;
    while(specificCount < 2) {
        const idx = Math.floor(Math.random() * 6);
        if(secretConcept[idx] === '?') {
            const domain = rawDomains[idx];
            secretConcept[idx] = domain[Math.floor(Math.random() * domain.length)];
            specificCount++;
        }
    }

    trainingData = [];
    for(let i=0; i<3; i++) { 
        const example = secretConcept.map((val, idx) => {
            if(val !== '?') return val;
            const domain = rawDomains[idx];
            return domain[Math.floor(Math.random() * domain.length)];
        });
        trainingData.push({ id: i+1, vals: example, target: 'Yes' });
    }

    const specificIndices = secretConcept.map((v, i) => v !== '?' ? i : -1).filter(i => i !== -1);
    const flipIdx = specificIndices[Math.floor(Math.random() * specificIndices.length)];
    
    const negExample = secretConcept.map((val, idx) => {
        const domain = rawDomains[idx];
        if(idx === flipIdx) {
            const otherOptions = domain.filter(d => d !== val);
            return otherOptions[Math.floor(Math.random() * otherOptions.length)];
        }
        return domain[Math.floor(Math.random() * domain.length)];
    });
    trainingData.push({ id: 4, vals: negExample, target: 'No' });

    const positiveExamples = trainingData.filter(d => d.target === 'Yes');
    
    let h = [...positiveExamples[0].vals];

    for(let i=1; i < positiveExamples.length; i++) {
        const currentEx = positiveExamples[i].vals;
        for(let j=0; j < 6; j++) {
            if(h[j] !== '?' && h[j] !== currentEx[j]) {
                h[j] = '?';
            }
        }
    }
    
    finalHypothesis = h;
    console.log("Solution:", finalHypothesis); 
}

/* =========================================================
   3) UI RENDERING
========================================================= */
const tableBody = document.getElementById("dataTableBody");
const inputContainer = document.getElementById("inputContainer");
const termBody = document.getElementById("termBody");
const predCard = document.getElementById("predCard");
const predVal = document.getElementById("predVal");
const predReason = document.getElementById("predReason");
const timerDisplay = document.getElementById("timerDisplay");

function startTimer() {
    clearInterval(timerInterval);
    seconds = 0;
    timerDisplay.innerText = "00:00";
    
    timerInterval = setInterval(() => {
        if(!isBlocked) {
            seconds++;
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            timerDisplay.innerText = `${m}:${s}`;
        }
    }, 1000);
}

function stopTimer() {
    clearInterval(timerInterval);
}

function renderTable() {
    tableBody.innerHTML = "";
    trainingData.forEach(row => {
        const tr = document.createElement("tr");
        let html = `<td style="font-weight:700; color:#94a3b8">#${row.id}</td>`;
        row.vals.forEach(v => { html += `<td>${v}</td>`; });
        const badgeClass = row.target === 'Yes' ? 'badge-yes' : 'badge-no';
        html += `<td><span class="badge ${badgeClass}">${row.target}</span></td>`;
        tr.innerHTML = html;
        tableBody.appendChild(tr);
    });
}

function renderInputs() {
  inputContainer.innerHTML = "";
  attributes.forEach((attr, idx) => {
    const group = document.createElement("div");
    group.className = "input-group";
    const label = document.createElement("label");
    label.innerText = attr;
    const select = document.createElement("select");
    select.id = `input-${idx}`;
    dropdownOptions[idx].forEach(opt => {
      const option = document.createElement("option");
      option.value = opt;
      option.innerText = opt;
      select.appendChild(option);
    });
    group.appendChild(label);
    group.appendChild(select);
    inputContainer.appendChild(group);
  });
}

function logTerm(msg, type="info") {
  const timeStr = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute:'2-digit', second:'2-digit' });
  const line = document.createElement("div");
  line.className = "log-line";
  
  let cls = "msg-info";
  if(type==="action") cls="msg-act";
  if(type==="success") cls="msg-suc";
  if(type==="error") cls="msg-err";
  if(type==="system") cls="msg-sys";

  line.innerHTML = `<span class="ts">[${timeStr}]</span><span class="${cls}">${msg}</span>`;
  const cursor = document.getElementById("termCursor");
  termBody.insertBefore(line, cursor);
  const termPanel = document.querySelector(".term-body");
  termPanel.scrollTop = termPanel.scrollHeight;
}

/* =========================================================
   4) GAME LOGIC
========================================================= */
function initGame() {
    generateScenario();
    renderTable();
    renderInputs();
    logTerm("New Randomized Scenario Generated.", "system");
    startTimer();
}

document.getElementById("btnPredict").onclick = () => {
  if(isBlocked) return;

  const userInputs = attributes.map((_, i) => document.getElementById(`input-${i}`).value);
  logTerm(`User Guess: <${userInputs.join(", ")}>`, "action");

  let isMatch = true;
  let mismatchReason = "";

  for(let i=0; i<attributes.length; i++) {
    const correctVal = finalHypothesis[i];
    const userVal = userInputs[i];

    if (userVal !== correctVal) {
      isMatch = false;
      mismatchReason = `Mismatch at '${attributes[i]}'. You guessed '${userVal}' but based on the data it should be '${correctVal}'.`;
      break; 
    }
  }

  predCard.classList.remove("show"); 
  void predCard.offsetWidth;
  predCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

  setTimeout(() => {
    predCard.classList.add("show");
    
    if(isMatch) {
      stopTimer();
      predVal.innerText = "CORRECT";
      predVal.style.color = "#16a34a";
      predReason.innerHTML = `Great job! You identified the hypothesis in <b>${timerDisplay.innerText}</b>. Refresh to play again.`;
      logTerm(`WINNER! Time: ${timerDisplay.innerText}`, "success");
      document.getElementById("btnPredict").disabled = true;
      document.getElementById("btnPredict").innerText = "Refresh Page to Play Again";
      document.getElementById("btnPredict").onclick = () => location.reload();
    } else {
      predVal.innerText = "INCORRECT";
      predVal.style.color = "#dc2626";
      predReason.innerText = mismatchReason;
      logTerm(`Result: INCORRECT - ${mismatchReason}`, "error");
    }
  }, 100);
};

// Start
initGame();

</script>
</body>
</html>